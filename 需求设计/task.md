# 小 x 宝社区志愿者小程序 任务清单（v2.3）

> 基于：`志愿者小程序设计_整理版.md`（2025-11-13）
> 目标：按 DDT（Development-Testing-Debugging）策略拆解为可执行任务，提升一次性交付成功率。

---

## 任务分组总览
- Development（开发）：架构、前后端、数据库、权限、功能实现
- Testing（测试）：单元、集成、系统、性能、安全
- Debugging（调试）：日志、排障、回归与质量度量
- Delivery（交付）：文档、CI/CD、部署与迁移

---

## Development（开发）
- 项目初始化
  - [ ] 初始化小程序项目与包管理（TS、Vant Weapp） （负责人：FE-小程序；协作：PM；截止：周1；交付：最小可运行骨架）
  - [ ] 初始化管理端 Vue 项目结构（路由、状态、UI基座） （负责人：FE-管理端；协作：PM；截止：周1；交付：基础路由与UI基座）
  - [ ] 初始化 Edge Functions 目录与工具链 （负责人：BE-函数；协作：DevOps；截止：周1；交付：函数模板与部署脚本）
  - [ ] 创建 `.env` 与环境变量注入（Supabase URL/Key） （负责人：DevOps；协作：DB/Platform；截止：周1；交付：环境变量与密钥管理方案）

- Supabase 基础配置
  - [ ] 创建 Supabase 项目与数据库扩展（uuid-ossp、pg_jsonschema） （负责人：DB/Platform；截止：周1；交付：项目与扩展启用）
  - [ ] 建立 `volunteers` 主表，增加 `auth_user_id` 字段 （负责人：DB/Platform；协作：BE-函数；截止：周1；交付：建表SQL与迁移）
  - [ ] 建立关联表：`communities`、`activities`、`activity_sign`、`messages`、`reports` （负责人：DB/Platform；截止：周2；交付：建表SQL与迁移）
  - [ ] 建立任务模块表：`tasks`、`task_signups` （负责人：DB/Platform；协作：BE-函数；截止：周2；交付：建表SQL与迁移）
  - [ ] 建立 GIN 索引：`industry_tags`、`skills` （负责人：DB/Platform；截止：周2；交付：索引脚本与验证报告）

- RLS 策略与权限
  - [ ] 启用 RLS 并编写公开查询策略（仅 `status=1 & searchable=true`） （负责人：DB/Platform；协作：BE-函数；截止：周2；交付：策略SQL与用例）
  - [ ] 编写本人更新策略：`auth.uid() = auth_user_id`（update/insert） （负责人：DB/Platform；截止：周2；交付：策略SQL与验证）
  - [ ] 管理员策略（管理端）：审核/冻结/导出（后续扩展） （负责人：DB/Platform；协作：FE-管理端；截止：周7；交付：受控接口与策略）
  - [ ] Storage 私有桶策略：敏感图片仅审核员可访问 （负责人：DB/Platform；协作：DevOps；截止：周4；交付：桶策略与审计日志）

- 小程序用户端功能
  - 注册与登录
    - [ ] 微信授权与手机号验证流程 （负责人：FE-小程序；协作：BE-函数；截止：周1；交付：登录成功与会话保持）
    - [ ] 绑定 `auth.uid()` 与 `volunteers.auth_user_id` （负责人：FE-小程序；协作：DB/Platform；截止：周1；交付：绑定成功验证）
    - [ ] 身份标签选择页（可跳过） （负责人：FE-小程序；截止：周2；交付：标签页与存储）
  - 个人中心
    - [ ] 资料编辑：头像、昵称、所在地、年份、标签、技能（≤3） （负责人：FE-小程序；协作：BE-函数；截止：周2；交付：资料保存与回显）
    - [ ] 隐私开关：显示二级标签/允许搜索/公开微信 （负责人：FE-小程序；协作：DB/Platform；截止：周2；交付：隐私状态联动与RLS一致）
    - [ ] 服务时长：签到自动累计 + 证明上传（待审） （负责人：FE-小程序；协作：BE-函数；截止：周3；交付：签到累计与上传通路）
    - [ ] 我的社团/活动卡片 + 活动订阅（导入微信日历） （负责人：FE-小程序；截止：周3；交付：卡片展示与订阅）
  - 志愿者墙
    - [ ] 列表与筛选（地区、领域、技能、在线） （负责人：FE-小程序；协作：DB/Platform；截止：周5；交付：筛选与分页性能）
    - [ ] 搜索（昵称、技能、社团） （负责人：FE-小程序；协作：BE-函数；截止：周5；交付：统一搜索接口）
    - [ ] 详情页「公益名片」隐藏单位与职位 （负责人：FE-小程序；截止：周5；交付：隐私不泄露）
  - 活动大厅
    - [ ] 发布（官方/个人，线上/线下，表单自定义） （负责人：FE-小程序；协作：BE-函数；截止：周3；交付：发布表单与落库）
    - [ ] 匹配（身份标签 + 技能推荐） （负责人：BE-函数；协作：FE-小程序；截止：周4；交付：推荐规则与API）
    - [ ] 报名 → 审核 → 签到（定位+二维码）→ 自动累时 → 评价 （负责人：FE-小程序；协作：BE-函数；截止：周4；交付：完整流程跑通）
  - 消息中心
    - [ ] 系统通知（审核/开始/时长） （负责人：BE-函数；协作：FE-小程序；截止：周6；交付：通知通道与模板）
    - [ ] 社团公告（二维码 7 天过期） （负责人：FE-小程序；协作：DB/Platform；截止：周6；交付：公告模块与过期策略）
    - [ ] 私信（文字+图片，48h撤回） （负责人：FE-小程序；协作：BE-函数；截止：周6；交付：会话与撤回逻辑）
  - 技能志愿 & 招募频道
    - [ ] 志愿者发布「1 小时公益咨询」 （负责人：FE-小程序；截止：周5；交付：发布与展示）
    - [ ] 机构发布急需技能（如 AI 训练师） （负责人：FE-小程序；协作：BE-函数；截止：周5；交付：发布与筛选）
    - [ ] 双向搜索与匹配 （负责人：BE-函数；协作：FE-小程序；截止：周5；交付：匹配算法与接口）

#### 新增：志愿者注册模块（补充）
- [ ] 扩展 `volunteers` 表字段：`real_name`、`wechat_id`、`service_directions(jsonb)`、`weekly_support_hours(smallint)`、`notes(text)`、`show_contact(boolean)`；添加检查约束与 GIN 索引。 （负责人：DB/Platform；截止：周1；交付：ALTER 脚本与索引）
- [ ] RLS 与隐私：公开查询不返回联系方式与实名，仅本人/管理员可访问；新增联系方式公开开关 `show_contact`。 （负责人：DB/Platform；协作：BE-函数；截止：周2；交付：策略SQL与用例）
- [ ] Edge Function：实现 `registerVolunteer`（创建/更新档案），含参数校验、权限与错误处理；与 `auth.uid()` 绑定。 （负责人：BE-函数；协作：FE-小程序；截止：周2；交付：函数代码与接口说明）
- [ ] 小程序注册表单：实名、手机号、微信号、服务方向（≤3 多选）、每周支援小时、备注；本地校验与就地错误提示；默认不公开联系方式。 （负责人：FE-小程序；截止：周2；交付：表单与校验）
- [ ] 数据落库与回显：首次注册插入记录；后续允许更新；资料页展示并可修改上述字段。 （负责人：FE-小程序；协作：BE-函数；截止：周2；交付：资料页联动）

- 管理端（Web-Vue）
  - [ ] 用户管理：身份审核、冻结、导出 （负责人：FE-管理端；协作：DB/Platform；截止：周7；交付：管理页面与接口）
  - [ ] 内容管理：动态/证明/举报 三审流 （负责人：FE-管理端；协作：BE-函数；截止：周7；交付：三审流实现）
  - [ ] 活动管理：置顶、加 V、批量导出签到表 （负责人：FE-管理端；截止：周7；交付：管理功能与导出）
  - [ ] 消息推送：标签 + 地区分段广播 （负责人：BE-函数；协作：FE-管理端；截止：周7；交付：推送模块）
  - [ ] 数据看板：日活、留存、技能供需图 （负责人：FE-管理端；协作：DB/Platform；截止：周7；交付：看板与指标）

- 任务发布模块（端到端）
  - [ ] 任务与报名表 Schema 创建（SQL） （负责人：DB/Platform；协作：BE-函数；截止：周8；交付：建表与迁移）
  - [ ] Edge Functions：`createTask`（参数校验/权限/异常） （负责人：BE-函数；截止：周8；交付：函数代码与单测）
  - [ ] Edge Functions：`assignTask`（发起人分配/状态流转） （负责人：BE-函数；截止：周8；交付：函数代码与单测）
  - [ ] Edge Functions：`completeTask`（完结与后续挂接） （负责人：BE-函数；截止：周8；交付：函数代码与单测）
  - [ ] 小程序前端：任务列表、详情、报名流程 （负责人：FE-小程序；协作：BE-函数；截止：周8；交付：页面与流程）

---

## Testing（测试）
- 单元测试
  - [ ] 边界输入与异常分支：`createTask/assignTask/completeTask` （负责人：QA；协作：BE-函数；截止：周8；交付：测试报告）
  - [ ] RLS 行为：公开查询与本人更新策略验证 （负责人：QA；协作：DB/Platform；截止：周2-周8；交付：策略用例与覆盖率）
  - [ ] 小程序关键组件：登录、资料编辑、筛选与报名 （负责人：QA；协作：FE-小程序；截止：周2-周5；交付：组件测试）
  - [ ] 新增 `registerVolunteer`：参数缺失、服务方向数量超限、小时数越界；未登录或 `auth.uid()` 不匹配；约束冲突与网络故障错误分支。 （负责人：QA；协作：FE-小程序/BE-函数；截止：周2；交付：测试用例与结果）

- 集成测试
  - [ ] 主流程：注册 → 报名 → 签到 → 时长累计 → 评价 （负责人：QA；协作：FE/BE；截止：周9；交付：E2E 报告）
  - [ ] 任务流程：发布 → 报名 → 分配 → 完成 （负责人：QA；协作：FE/BE；截止：周8；交付：E2E 报告）
  - [ ] 管理端：审核流程与消息推送 （负责人：QA；协作：FE-管理端/BE-函数；截止：周7；交付：流程验证）
  - [ ] 新增：注册档案创建/更新 → 资料页回显 → 公开查询不含联系方式/实名。 （负责人：QA；协作：FE-小程序/DB；截止：周2；交付：隐私验证）

- 系统测试
  - [ ] 隐私开关与 RLS 一致性验证 （负责人：QA；协作：DB/Platform；截止：周2-周9；交付：一致性报告）
  - [ ] 文件访问控制（私有桶）与审计 （负责人：QA；协作：DevOps/DB；截止：周4；交付：访问控制用例）
  - [ ] 新增：`show_contact` 关闭时，公开接口与看板不泄露联系方式。 （负责人：QA；协作：FE/BE；截止：周2；交付：不泄露证明）

- 性能与安全
  - [ ] 列表高并发：任务与活动响应时延与错误率 （负责人：QA；协作：BE/FE；截止：周5-周8；交付：性能报告）
  - [ ] 安全扫描：常见漏洞与权限越权检查 （负责人：QA；协作：DevOps；截止：周9；交付：扫描报告）
  - [ ] 新增：注册表单高并发提交（限流与退避重试）。 （负责人：QA；协作：FE/BE；截止：周2；交付：并发测试用例）

---

## Debugging（调试）
- [ ] 统一错误码与错误文案（前后端映射） （负责人：PM；协作：FE/BE；截止：周3；交付：错误码规范）
- [ ] Edge Functions 与小程序端日志采集（关键路径） （负责人：BE-函数；协作：FE；截止：周3；交付：日志上报与留存）
- [ ] 失败重试与回退策略（报名/分配/完成） （负责人：BE-函数；协作：PM；截止：周4；交付：重试策略与回退预案）
- [ ] 回归测试清单与质量门禁（CI 阶段） （负责人：QA；协作：DevOps；截止：周9；交付：CI 报告与门禁）

---

## Delivery（交付）
- 文档与清单
  - [ ] `docs/design_v2.3.md` 整理与更新 （负责人：PM；协作：FE/BE/DB；截止：周9；交付：最新设计文档）
  - [ ] `api.openapi.yml` 初版与接口示例 （负责人：BE-函数；协作：FE；截止：周8；交付：OpenAPI 文件）
  - [ ] `sql/supabase_schema.sql` 与 `sql/RLS_examples.sql` （负责人：DB/Platform；截止：周2-周8；交付：SQL 与示例）
- 部署与迁移
  - [ ] GitHub Actions：小程序上传与体验码生成 （负责人：DevOps；协作：FE；截止：周9；交付：流水线与体验码）
  - [ ] 生产环境：Supabase Pro + 阿里云 CDN （负责人：DevOps；协作：DB/Platform；截止：周9；交付：上线记录）
  - [ ] 迁移预案：`pg_dump` + 阿里云 DTS（停机 <30 分钟） （负责人：DB/Platform；协作：DevOps；截止：预研阶段；交付：迁移与回滚预案）

---

## 里程碑（周）
- 1-2：账号与资料（注册、登录、标签选择、RLS）
- 3-4：活动流（发布/报名/签到/时长）
- 5：搜索与匹配（志愿者墙、技能频道）
- 6：社团与消息（创建、私信、公告）
- 7：管理后台（审核、看板、推送）
- 8：任务发布（发布、报名、分配、完成）
- 9：测试与上线（安全扫描、小程序审核、发布）

---

## 验收标准（示例）
- 功能可用：主流程全链路跑通，异常分支有明确反馈
- 权限正确：RLS 与隐私开关行为一致，无越权
- 性能达标：列表在目标并发下 P95 响应可接受
- 文档齐备：设计、接口、SQL、部署、回滚预案完备

---

## 风险与预案（精简）
- Supabase 网络延迟：必要时迁移国内 RDS（DTS）
- 隐私合规：严格最小化采集与访问审计
- 高并发：索引与分页策略、必要时引入缓存层

---

（本任务清单仅保留与设计实现直接相关的工作项，已按 DDT 策略组织，以便快速执行与验证。）